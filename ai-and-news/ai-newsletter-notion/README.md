# AI情報配信 & Notion更新システム

AIに関する最新情報と業務効率化アイデアを定期的に配信し、Notionページを自動更新するGoogle Apps Script (GAS) システムです。

## 機能

### 📰 定期配信機能
- **朝7時**: 昨日のAIニュースまとめ
- **昼12時**: AIビジネス&効率化アイデア  
- **夕方18時**: 本日のAI最新ニュース

### 📝 Notion連携
- ニュース用とアイデア用の**別々のNotionデータベース**に自動保存
- マークダウン形式からNotionブロックへの自動変換
- 日付、タイプ、ステータスの自動設定

### 📧 メール配信
- HTMLフォーマットの美しいメールテンプレート
- 複数の配信先に個別送信
- 配信タイミングごとに異なるデザイン

## セットアップ手順

### 1. Google Apps Scriptプロジェクトの作成

1. [Google Drive](https://drive.google.com)を開く
2. 新規 → その他 → Google Apps Script を選択
3. プロジェクト名を「AI情報配信システム」に変更

### 2. ファイルの配置

以下のファイルをプロジェクトに追加：

- `AINewsNotionUpdater.gs` - メインスクリプト
- `setup.html` - 設定用HTMLインターフェース

### 3. APIキーの取得

#### Perplexity API
1. [Perplexity AI](https://www.perplexity.ai/)でアカウント作成
2. Settings → API → Generate API Key
3. キーをコピー（`pplx-`で始まる）

#### Grok API  
1. [x.ai](https://x.ai/)でアカウント作成
2. API設定からキーを生成
3. キーをコピー（`xai-`で始まる）

#### Notion API
1. [Notion Developers](https://www.notion.so/my-integrations)にアクセス
2. 「New integration」をクリック
3. 必要な権限を設定してインテグレーションを作成
4. Internal Integration Tokenをコピー（`secret_`で始まる）

### 4. Notionデータベースの準備

#### ニュース用データベース
以下のプロパティを持つデータベースを作成：
- タイトル (Title)
- 日付 (Date)
- タイプ (Select: ニュース/ビジネスアイデア)
- ステータス (Select: 公開/下書き)

#### アイデア用データベース
同じプロパティ構成で別のデータベースを作成

#### データベースIDの取得
1. Notionでデータベースページを開く
2. URLから以下の部分をコピー：
   ```
   https://www.notion.so/xxxxx/[ここがデータベースID]/yyyyy
   ```

### 5. インテグレーションの接続

1. 各Notionデータベースページで「...」メニューをクリック
2. 「Connections」→「Add connections」
3. 作成したインテグレーションを選択

### 6. GASでの初期設定

1. スクリプトエディタでメニューが表示されるまで待つ
2. 「📰 AI情報配信」→「⚙️ 初期設定」をクリック
3. 設定ダイアログで以下を入力：
   - APIキー（3種類）
   - NotionデータベースID（2つ）
   - 配信先メールアドレス

### 7. トリガーの設定

1. 「📰 AI情報配信」→「🔄 トリガー設定」をクリック
2. 自動的に3つの時間トリガーが設定される

## 使用方法

### テスト配信

設定完了後、以下の方法でテスト可能：

```
📰 AI情報配信 → 🧪 テスト配信 → 
  - 🌅 朝のニュース
  - 💡 ビジネスアイデア  
  - 🌆 夕方のニュース
```

### ステータス確認

```
📰 AI情報配信 → 📊 ステータス確認
```

現在の設定状態とトリガーの状態を確認できます。

## カスタマイズ

### 配信時間の変更

`AINewsNotionUpdater.gs`の`CONFIG.SCHEDULE`を編集：

```javascript
SCHEDULE: {
  MORNING: { hour: 7, type: 'morning_news' },    // 朝の時間
  NOON: { hour: 12, type: 'business_ideas' },    // 昼の時間
  EVENING: { hour: 18, type: 'evening_news' }    // 夕方の時間
}
```

### コンテンツ形式の調整

各生成関数（`generateMorningNews`、`generateBusinessIdeas`、`generateEveningNews`）内のプロンプトを編集して、出力形式をカスタマイズできます。

### メールテンプレートの変更

`createEmailHTML`関数でHTMLテンプレートをカスタマイズ可能です。

## トラブルシューティング

### よくある問題と解決方法

#### APIエラーが発生する
- APIキーが正しく設定されているか確認
- APIの利用制限に達していないか確認
- PropertiesServiceに正しく保存されているか確認

#### Notionページが作成されない
- インテグレーションがデータベースに接続されているか確認
- データベースIDが正しいか確認
- Notionのプロパティ名が一致しているか確認

#### メールが届かない
- GASの実行権限を確認
- メールアドレスが正しく設定されているか確認
- Gmailの送信制限に達していないか確認

### デバッグ方法

1. スクリプトエディタで「実行」→「関数を選択」
2. テスト関数を実行
3. 「表示」→「ログ」でエラーメッセージを確認

## 注意事項

- APIキーは安全に管理してください
- Gmailの送信制限（1日100通）に注意
- Notion APIの制限（1秒3リクエスト）に注意
- 定期実行のタイムゾーンはプロジェクト設定で確認

## ライセンス

このプロジェクトは個人利用を目的としています。商用利用の際はAPIプロバイダーの利用規約を確認してください。

## サポート

問題が発生した場合は、以下を確認してください：

1. Google Apps Scriptのログ
2. 各APIサービスのステータスページ
3. Notionインテグレーションの権限設定

## 更新履歴

- v1.0.0 (2024-08-24): 初版リリース
  - 3回/日の自動配信機能
  - Notion自動更新
  - HTMLメール配信
  - 設定用UI