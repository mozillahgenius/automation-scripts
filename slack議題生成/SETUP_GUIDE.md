# 📚 Slack議題生成システム セットアップガイド

## 🎯 概要

このシステムは、Slackのメッセージを自動的に収集・分析し、議題候補の抽出、マニュアル・FAQ生成、日次レポート送信などを行う統合システムです。

## 📋 必要な準備

### 1. Google アカウント
- Google Workspace または個人のGoogleアカウント
- Google Apps Script の実行権限

### 2. Slack ワークスペース
- Slack App を作成できる権限
- Bot を追加できる権限

### 3. OpenAI アカウント
- API キーの作成権限
- GPT-4 API へのアクセス（推奨）

## 🚀 セットアップ手順

### ステップ 1: Google スプレッドシートの準備

1. 新しい Google スプレッドシートを作成
2. メニューから「拡張機能」→「Apps Script」を開く
3. 以下のファイルをコピー＆ペースト：
   - `IntegratedSlackSystem.gs` - メインシステム
   - `Setup.gs` - セットアップ関数
   - `setup.html` - 設定画面

### ステップ 2: Slack App の作成と設定

#### 2.1 Slack App の作成

1. [Slack API](https://api.slack.com/apps) にアクセス
2. 「Create New App」をクリック
3. 「From scratch」を選択
4. App Name: `Slack議題生成Bot`（任意）
5. Workspace を選択

#### 2.2 Bot Token Scopes の設定

OAuth & Permissions ページで以下の Bot Token Scopes を追加：

**必須スコープ：**
```
channels:history     - 公開チャンネルのメッセージを読む
channels:read        - 公開チャンネルの情報を取得
chat:write          - メッセージを送信
groups:history      - プライベートチャンネルのメッセージを読む
groups:read         - プライベートチャンネルの情報を取得
im:history          - ダイレクトメッセージを読む
mpim:history        - グループDMを読む
users:read          - ユーザー情報を取得
```

**オプションスコープ（推奨）：**
```
files:read          - ファイル情報を取得
reactions:read      - リアクション情報を取得
team:read          - チーム情報を取得
```

#### 2.3 Bot のインストール

1. OAuth & Permissions ページで「Install to Workspace」をクリック
2. 権限を確認して「許可する」
3. 表示される `Bot User OAuth Token` をコピー（xoxb-で始まる文字列）

#### 2.4 Bot をチャンネルに追加

監視したい各チャンネルで以下を実行：
```
/invite @Slack議題生成Bot
```

### ステップ 3: OpenAI API キーの取得

1. [OpenAI Platform](https://platform.openai.com/) にログイン
2. 右上のアカウントメニューから「API keys」を選択
3. 「Create new secret key」をクリック
4. キーをコピー（sk-で始まる文字列）

**注意事項：**
- APIキーは一度しか表示されません
- 安全な場所に保管してください
- 他人と共有しないでください

### ステップ 4: システムの初期設定

#### 4.1 初回セットアップの実行

1. スプレッドシートを開く
2. 少し待つとメニューに「🤖 統合議題生成システム」が表示される
3. メニューから「⚙️ 初期設定」を選択
4. 表示されるダイアログで `runInitialSetup()` を実行

**または Apps Script エディタで：**
```javascript
function manualSetup() {
  runInitialSetup();
}
```

#### 4.2 API 認証情報の設定

セットアップウィザードが開いたら：

1. **Slack設定タブ**
   - Bot Token を入力
   - 「接続テスト」をクリックして確認

2. **OpenAI設定タブ**
   - API Key を入力
   - 「接続テスト」をクリックして確認

3. **一般設定タブ**
   - レポート送信先メールアドレスを入力
   - 監視対象チャンネルID（オプション）を入力

4. 「設定を保存」→「セットアップ完了」をクリック

### ステップ 5: 自動実行の設定

#### 5.1 トリガーの設定

メニューから「⏰ 自動実行タイマー設定」を選択

設定される自動実行：
- **30分ごと**: Slack同期
- **1時間ごと**: AI分析
- **毎日9時**: 日次レポート送信
- **毎日15時**: 議題候補通知

#### 5.2 手動でトリガーを設定する場合

Apps Script エディタで：
1. 時計アイコン（トリガー）をクリック
2. 「トリガーを追加」
3. 以下を設定：
   - 実行する関数: `syncAllSlackChannels`
   - イベントのソース: 時間主導型
   - 時間ベースのトリガーのタイプ: 分ベースのタイマー
   - 間隔: 30分ごと

## 🔧 詳細設定

### Config シートの設定項目

| 設定項目 | 説明 | 例 |
|---------|------|-----|
| company | 会社名 | 株式会社サンプル |
| targetChannels | 監視対象チャンネルID | C1234567890, C0987654321 |
| notifySlackChannel | 通知先チャンネルID | C1234567890 |
| notifyEmails | 通知先メールアドレス | admin@example.com |
| openaiModel | 要約用AIモデル | gpt-4o-mini |
| openaiModelDraft | ドラフト生成用AIモデル | gpt-4o |
| classificationThreshold | 該当判定しきい値 | 0.6 |
| syncIntervalMinutes | Slack同期間隔（分） | 30 |
| analysisIntervalHours | AI分析間隔（時間） | 1 |
| notificationHours | 通知時刻 | 9,15 |

### Categories シートのカスタマイズ

議題のカテゴリを追加・編集できます：

| カテゴリ名 | 説明 | 判定基準 | キーワード | 重要度 |
|-----------|------|---------|-----------|--------|
| 緊急対応 | 即座の対応が必要 | 24時間以内の対応が必要な事項 | 緊急,至急,ASAP,今すぐ | 高 |
| プロジェクト進捗 | プロジェクトの状況報告 | 進捗率や課題の共有 | 進捗,完了,遅延,課題 | 中 |
| 意思決定事項 | 決定が必要な事項 | 承認や決裁が必要 | 承認,決定,決裁,判断 | 高 |

## 🔍 トラブルシューティング

### よくある問題と解決方法

#### 1. メニューが表示されない
- **原因**: スクリプトが読み込まれていない
- **解決**: ページを再読み込みして数秒待つ

#### 2. Slack接続エラー
- **原因**: トークンが無効または権限不足
- **解決**: 
  - Bot Token が正しくコピーされているか確認
  - 必要なスコープが全て追加されているか確認
  - Bot がチャンネルに追加されているか確認

#### 3. OpenAI エラー
- **原因**: API キーが無効または利用制限
- **解決**:
  - API キーが正しくコピーされているか確認
  - OpenAI アカウントの利用制限を確認
  - 請求設定が有効か確認

#### 4. メール送信エラー
- **原因**: Gmail の送信制限
- **解決**:
  - 1日の送信制限（100通）を確認
  - Google Workspace の場合は管理者に確認

### エラーログの確認方法

1. スプレッドシートの「Logs」シートを確認
2. Apps Script エディタの「実行」タブでログを確認
3. エラーレベルのログは赤色で表示される

## 📊 使用方法

### 手動実行

メニューから各機能を個別に実行：
- 🔄 **Slack全チャンネル同期**: 最新メッセージを取得
- 🤖 **AI分析実行**: メッセージを分析して議題候補を抽出
- 📊 **過去ログ分析**: 過去7日間のメッセージを分析
- 📚 **マニュアル・FAQ生成**: ドキュメントを自動生成
- 📧 **日次レポート送信**: レポートをメール送信

### データの確認

各シートで結果を確認：
- **Messages**: 全メッセージと分析結果
- **slack_log**: 詳細なSlackログ
- **business_manual**: 生成されたマニュアル
- **faq_list**: 生成されたFAQ
- **daily_report**: 日次レポート履歴

## 🔒 セキュリティに関する注意

### APIキーの管理
- APIキーは Google Apps Script の Properties Service に暗号化して保存
- コード内に直接記載しない
- 定期的にキーをローテーション

### アクセス権限
- スプレッドシートの共有設定を適切に管理
- 必要最小限のユーザーのみアクセス許可
- 編集権限は管理者のみに制限

### データの取り扱い
- 機密情報を含むチャンネルは監視対象から除外
- 個人情報の取り扱いに注意
- 定期的にログをクリーンアップ

## 📞 サポート

### ドキュメント
- [Google Apps Script 公式ドキュメント](https://developers.google.com/apps-script)
- [Slack API ドキュメント](https://api.slack.com/docs)
- [OpenAI API ドキュメント](https://platform.openai.com/docs)

### よくある質問

**Q: 無料で使えますか？**
A: Google Apps Script は無料ですが、以下の制限があります：
- 実行時間: 6分/実行、90分/日
- API呼び出し: 20,000回/日
- OpenAI API は従量課金制

**Q: 複数のワークスペースで使えますか？**
A: 各ワークスペースごとに Slack App を作成し、別々のスプレッドシートで管理してください。

**Q: データはどこに保存されますか？**
A: すべてのデータは Google スプレッドシートに保存されます。Google Drive の容量制限に注意してください。

## 📝 更新履歴

### Version 1.0.0 (2024-01)
- 初回リリース
- 基本機能の実装
- Slack同期、AI分析、レポート生成

## 📄 ライセンス

このプロジェクトは MIT ライセンスのもとで公開されています。