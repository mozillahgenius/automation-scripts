Googleカレンダー抽出ツール 仕様書

1. 概要

Googleカレンダー API と Google Apps Script (GAS) を活用し、指定条件に合致する予定情報を Googleスプレッドシートに抽出する仕組み。
特に Google グループのメールアドレスを条件に含め、イベント参加者の中に特定グループまたはそのメンバーが含まれている場合のみ抽出できる。

⸻

2. 対象範囲
	•	入力
	•	Google カレンダー（1つ以上のカレンダーIDを指定可能）
	•	Google グループ（Groupsシートに列挙）
	•	出力
	•	Google スプレッドシート（Eventsシート）に抽出結果を一覧化
	•	ユーザー操作
	•	メニュー「Calendar Export」から Setup / Run Export を選択

⸻

3. シート構成

(1) Config シート

KEY	VALUE例	説明
START_DATE	2025-09-01	抽出開始日
END_DATE	2025-09-30	抽出終了日
CALENDAR_IDS	primary, sub-calendar-id@group.calendar.google.com	対象カレンダー（カンマ区切り）
GROUP_MODE	DIRECT_GROUP または MEMBER_OF_GROUP	グループ判定モード
GROUP_MATCH	ANY または ALL	条件一致の方式（ANY=1つでも一致、ALL=全て一致）
TIMEZONE	Asia/Kuala_Lumpur	出力時刻のタイムゾーン


⸻

(2) Groups シート
	•	A列にグループアドレスを1行ずつ記載
	•	例:

team@yourdomain.com
all@yourdomain.com
project-x@yourdomain.com



⸻

(3) Events シート（出力）

項目	内容
CalendarId	抽出元のカレンダーID
EventId	イベントID
Summary	イベントタイトル
Start / End	開始・終了日時（タイムゾーン変換済）
Organizer	主催者メール
Attendees	出席者メール（カンマ区切り）
MatchMode	DIRECT_GROUP / MEMBER_OF_GROUP
MatchedGroup	一致したグループアドレス（複数時は区切り）
MatchDetail	GROUP_INVITED または MEMBER_INVITED:xxxx
Location	場所
HangoutLink	Google Meetリンク
Created / Updated	作成日時 / 更新日時
Visibility	公開範囲


⸻

4. 機能仕様

(A) グループ判定モード
	•	DIRECT_GROUP
→ 参加者リストまたは主催者に「グループアドレス自体」が含まれている場合のみ抽出。
（例: team@yourdomain.com が直接招待されている）
	•	MEMBER_OF_GROUP
→ 参加者または主催者が「グループのメンバー」である場合も抽出。
（Admin SDK Directory API が必要）

⸻

(B) 条件一致方式（GROUP_MATCH）
	•	ANY
→ Groupsシートのいずれか1つでも一致すれば抽出（OR条件）
	•	ALL
→ Groupsシートに列挙したすべてのグループ条件に一致するイベントのみ抽出（AND条件）

⸻

(C) 実行フロー
	1.	ユーザーがメニューから Run Export を実行
	2.	Configシートを読み込み → 抽出条件を確定
	3.	Groupsシートを読み込み → グループ一覧を取得
	4.	(MEMBER_OF_GROUP の場合) Admin SDK でグループメンバーリストを取得・キャッシュ
	5.	Calendar API で対象期間のイベントを全件取得（ページネーション対応）
	6.	イベントごとに条件判定
	•	MatchMode / GroupMatch / Details を判定
	7.	条件一致イベントのみ Eventsシートへ書き込み

⸻

5. 前提条件
	•	Google Apps Script 権限
	•	Calendar API → 有効化必須
	•	MEMBER_OF_GROUP利用時 → Admin SDK Directory API 有効化 & 管理者アカウントで実行
	•	Google Workspace 環境
	•	グループのメンバー情報取得には組織管理権限が必要

⸻

6. 制約事項
	•	イベント数が多い場合（> 2500件/月） → 実行時間制限に注意
	•	グループメンバーが多い場合 → Admin SDK の呼び出し制限あり
	•	現仕様では 全件削除→再出力。差分更新は未対応
	•	グループ条件は「メールアドレス完全一致」のみ（ドメイン単位判定は未対応）

⸻

7. 拡張余地
	•	差分更新モード：EventIdをキーにして追加・更新のみ
	•	除外条件：特定のグループ/ドメインを除外する設定
	•	キャッシュ強化：PropertiesService にグループメンバーを保存し、1日単位で再取得
	•	シート分割出力：グループごとに別シートへ抽出
	•	Slack/メール通知：抽出完了時に通知を送信

⸻

8. 運用イメージ
	•	月次レポート: 2025-09-01〜2025-09-30 のイベントを抽出して監査用に保管
	•	グループ別会議記録: 各プロジェクトグループが招待された会議のみ抽出
	•	コンプライアンス監査: 特定部門のメンバーが参加している社外会議の把握
