<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
    }
    h2 {
      color: #333;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
    .section {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      color: #555;
    }
    input[type="text"],
    input[type="email"],
    input[type="date"],
    select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
      font-size: 14px;
    }
    button {
      padding: 8px 16px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn-primary {
      background-color: #4CAF50;
      color: white;
    }
    .btn-primary:hover {
      background-color: #45a049;
    }
    .btn-danger {
      background-color: #f44336;
      color: white;
    }
    .btn-secondary {
      background-color: #757575;
      color: white;
    }
    .officer-list {
      max-height: 300px;
      overflow-y: auto;
    }
    .officer-item {
      padding: 10px;
      margin: 5px 0;
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .officer-info {
      flex-grow: 1;
    }
    .officer-name {
      font-weight: bold;
      color: #333;
    }
    .officer-position {
      color: #666;
      margin-left: 10px;
    }
    .officer-email {
      font-size: 12px;
      color: #999;
    }
    .message {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <h2>役員管理</h2>

  <div id="messageArea"></div>

  <!-- 役員一覧 -->
  <div class="section">
    <h3>登録済み役員</h3>
    <button class="btn-primary" onclick="loadOfficers()">一覧を更新</button>
    <div id="officersList" class="officer-list">
      <p>ボタンを押して読み込んでください</p>
    </div>
  </div>

  <!-- 新規役員追加 -->
  <div class="section">
    <h3>新規役員追加</h3>
    <div class="form-group">
      <label>氏名 <span style="color:red;">*</span></label>
      <input type="text" id="newName" placeholder="山田太郎">
    </div>
    <div class="form-group">
      <label>役職 <span style="color:red;">*</span></label>
      <input type="text" id="newPosition" placeholder="代表取締役社長">
    </div>
    <div class="form-group">
      <label>メールアドレス</label>
      <input type="email" id="newEmail" placeholder="yamada@example.com">
    </div>
    <div class="form-group">
      <label>役員区分</label>
      <select id="newCategory">
        <option value="">選択してください</option>
        <option value="取締役">取締役</option>
        <option value="監査役">監査役</option>
        <option value="執行役">執行役</option>
        <option value="その他">その他</option>
      </select>
    </div>
    <div class="form-group">
      <label>在任開始日</label>
      <input type="date" id="newStartDate">
    </div>
    <div class="form-group">
      <label>備考</label>
      <input type="text" id="newNote" placeholder="常勤、社外など">
    </div>
    <button class="btn-primary" onclick="addOfficer()">追加</button>
    <button class="btn-secondary" onclick="clearForm()">クリア</button>
  </div>

  <div class="loading">
    <p>処理中...</p>
  </div>

  <script>
    let officersList = [];

    // ページ読み込み時
    window.onload = function() {
      loadOfficers();
    };

    // 役員一覧を読み込み
    function loadOfficers() {
      showLoading(true);
      clearMessage();

      google.script.run
        .withSuccessHandler(function(officers) {
          showLoading(false);
          officersList = officers;
          displayOfficers(officers);
        })
        .withFailureHandler(function(error) {
          showLoading(false);
          showMessage('役員一覧の取得に失敗しました: ' + error, true);
        })
        .getOfficersList();
    }

    // 役員一覧を表示
    function displayOfficers(officers) {
      const container = document.getElementById('officersList');

      if (!officers || officers.length === 0) {
        container.innerHTML = '<p>役員が登録されていません</p>';
        return;
      }

      let html = '';
      officers.forEach(officer => {
        html += `
          <div class="officer-item">
            <div class="officer-info">
              <span class="officer-name">${officer.name}</span>
              <span class="officer-position">${officer.position}</span>
              ${officer.email ? `<div class="officer-email">${officer.email}</div>` : ''}
            </div>
            <button class="btn-danger" onclick="deleteOfficer('${officer.name}')">削除</button>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // 役員追加
    function addOfficer() {
      const name = document.getElementById('newName').value.trim();
      const position = document.getElementById('newPosition').value.trim();

      if (!name || !position) {
        showMessage('氏名と役職は必須です', true);
        return;
      }

      const officerData = {
        name: name,
        position: position,
        email: document.getElementById('newEmail').value.trim(),
        category: document.getElementById('newCategory').value,
        startDate: document.getElementById('newStartDate').value,
        note: document.getElementById('newNote').value.trim()
      };

      showLoading(true);
      clearMessage();

      google.script.run
        .withSuccessHandler(function(result) {
          showLoading(false);
          if (result.success) {
            showMessage('役員を追加しました', false);
            clearForm();
            loadOfficers();
          } else {
            showMessage(result.error || '追加に失敗しました', true);
          }
        })
        .withFailureHandler(function(error) {
          showLoading(false);
          showMessage('エラー: ' + error, true);
        })
        .addOfficer(officerData);
    }

    // 役員削除
    function deleteOfficer(name) {
      if (!confirm(`${name}を削除してもよろしいですか？`)) {
        return;
      }

      showLoading(true);
      clearMessage();

      google.script.run
        .withSuccessHandler(function(result) {
          showLoading(false);
          if (result.success) {
            showMessage('役員を削除しました', false);
            loadOfficers();
          } else {
            showMessage(result.error || '削除に失敗しました', true);
          }
        })
        .withFailureHandler(function(error) {
          showLoading(false);
          showMessage('エラー: ' + error, true);
        })
        .deleteOfficer(name);
    }

    // フォームクリア
    function clearForm() {
      document.getElementById('newName').value = '';
      document.getElementById('newPosition').value = '';
      document.getElementById('newEmail').value = '';
      document.getElementById('newCategory').value = '';
      document.getElementById('newStartDate').value = '';
      document.getElementById('newNote').value = '';
    }

    // メッセージ表示
    function showMessage(message, isError) {
      const messageArea = document.getElementById('messageArea');
      messageArea.innerHTML = `
        <div class="message ${isError ? 'error' : 'success'}">
          ${message}
        </div>
      `;

      setTimeout(function() {
        clearMessage();
      }, 5000);
    }

    // メッセージクリア
    function clearMessage() {
      document.getElementById('messageArea').innerHTML = '';
    }

    // ローディング表示
    function showLoading(show) {
      document.querySelector('.loading').style.display = show ? 'block' : 'none';
    }
  </script>
</body>
</html>