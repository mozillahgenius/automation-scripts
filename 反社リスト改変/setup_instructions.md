# 反社リスト変換GASセットアップ手順

## 1. Google スプレッドシートの準備

### 1.1 元データのアップロード
1. Googleドライブにアクセス
2. 新規 → ファイルのアップロード
3. `20250917 制裁リスト (原本 PW bts0917).xlsx` をアップロード
4. アップロード後、ファイルを右クリック → 「Google スプレッドシートで開く」
5. URLからスプレッドシートIDをコピー（`/spreadsheets/d/[ここの部分]/edit`）

### 1.2 出力用スプレッドシートの作成
1. Googleドライブで新規 → Google スプレッドシート
2. ファイル名を「反社リスト_変換済み」などに設定
3. URLからスプレッドシートIDをコピー

### 1.3 CSV出力用フォルダの作成
1. Googleドライブで新規 → フォルダ
2. フォルダ名を「反社リスト_CSV出力」などに設定
3. フォルダを開き、URLからフォルダIDをコピー（`/folders/[ここの部分]`）

## 2. GASスクリプトの設定

### 2.1 スクリプトエディタを開く
1. 出力用スプレッドシートを開く
2. 拡張機能 → Apps Script

### 2.2 スクリプトをコピー
1. `processAntiSocialList.gs` の内容を全てコピー
2. スクリプトエディタに貼り付け

### 2.3 IDを設定
スクリプト内の以下の部分を実際のIDに置き換え：

```javascript
// 8行目付近
const sourceSheetId = '元データのスプレッドシートID'; // ← ここに1.1でコピーしたID
const targetSheetId = '出力先のスプレッドシートID'; // ← ここに1.2でコピーしたID

// exportToCSV関数内（220行目付近）
const targetSheetId = '出力先のスプレッドシートID'; // ← ここに1.2でコピーしたID
const folderId = 'Google DriveのフォルダID'; // ← ここに1.3でコピーしたID
```

### 2.4 保存と権限設定
1. Ctrl+S（またはCmd+S）で保存
2. 初回実行時に権限の承認が必要
   - 「権限を確認」→「詳細」→「安全でないページに移動」→「許可」

## 3. 使用方法

### 3.1 データ変換の実行
1. 出力用スプレッドシートを開く
2. メニューバーに「反社リスト処理」が表示される
3. 反社リスト処理 → データ変換処理を実行
4. 処理完了まで待つ（5941件で約2-3分）

### 3.2 CSV出力
1. 反社リスト処理 → CSVファイルを出力
2. 指定したGoogle Driveフォルダに CSV ファイルが作成される

## 4. 出力データの確認

### 出力フォーマット
- 등록일자: 処理実行日
- 고객구분: 01（個人）または 02（法人）
- 한글명: 日本語名
- 영문명: ローマ字変換された名前
- 성별: 1（男）、2（女）、空欄（不明）
- 생년월일: 年齢から逆算した概算年
- 국적: JP（固定）
- 사용여부: Y（固定）
- 출처: 暴力団追放運動推進都民センター
- 거주지: 住所
- 비고: 異名、組織、その他情報

### データ分割
- 350件ごとに自動分割
- Batch_1, Batch_2... という名前でシート作成
- 各バッチが個別のCSVファイルとして出力

## 5. トラブルシューティング

### エラーが発生する場合
1. スプレッドシートID、フォルダIDが正しいか確認
2. 元データのシート名が「基本データ」であることを確認
3. Google Driveの容量が十分にあるか確認

### データが正しく変換されない場合
1. 元データの列構成が変更されていないか確認
2. カナ変換がうまくいかない場合は、convertKanaToRomaji関数を調整

## 6. 定期運用

毎月の更新時：
1. 新しい制裁リストをGoogleドライブにアップロード
2. スクリプトの sourceSheetId を新しいIDに更新
3. データ変換処理を実行
4. CSVファイルを出力
5. システムにアップロード（350件ずつ）