# 前日比レポート自動送信システム セットアップガイド

このガイドでは、システムを0から導入するための詳細な手順を説明します。

## 📋 事前準備

### 必要なもの
- Googleアカウント
- Googleスプレッドシートへのアクセス
- Google Apps Scriptの実行権限

### 想定データ形式
```
| ID  | 名称     | 値    | その他の列... |
|-----|----------|-------|---------------|
| P001| 商品A    | 12500 | ...           |
| P002| 商品B    | 8300  | ...           |
```

## 🚀 ステップ1: スプレッドシートの作成

### 1.1 新しいスプレッドシートを作成
1. [Google Sheets](https://sheets.google.com) にアクセス
2. 「空白」テンプレートで新しいシートを作成
3. ファイル名を「業績Dailyレポート」等に変更

### 1.2 必要なシートタブを作成
デフォルトの「シート1」を以下のように変更・追加：

1. **「シート1」を「今日」に名前変更**
   - シートタブを右クリック → 「名前を変更」

2. **「前日」シートを追加**
   - シートタブの「+」ボタンで新しいシートを追加
   - 名前を「前日」に変更

3. **「設定」シートを追加**
   - 同様に新しいシートを追加
   - 名前を「設定」に変更

4. **「ログ」シートを追加**
   - 同様に新しいシートを追加
   - 名前を「ログ」に変更

### 1.3 データシート（今日シート）の設定
`今日` シートに以下のヘッダーを設定：

```
A1: ID
B1: 名称
C1: 値
D1: [その他の列名...]
```

**重要**: 
- `ID` 列は必須です
- `値` 列は差分計算の基本列として使用されます
- 列名は後で設定で変更可能です

### 1.4 サンプルデータの入力（テスト用）
`今日` シートに以下のようなサンプルデータを入力：

```
| ID   | 名称   | 値    |
|------|--------|-------|
| P001 | 商品A  | 12500 |
| P002 | 商品B  | 8300  |
| P003 | 商品C  | 15200 |
```

## 🚀 ステップ2: Google Apps Scriptの設定

### 2.1 Apps Scriptプロジェクトの作成
1. スプレッドシートで「拡張機能」メニュー → 「Apps Script」を選択
2. 新しいブラウザタブでApps Scriptエディタが開きます
3. プロジェクト名を「前日比レポート」等に変更

### 2.2 コードの配置
1. 既存の `Code.gs` ファイルの内容をすべて削除
2. `dailyReport.gs` の内容をすべてコピー
3. Apps Scriptエディタにペースト
4. 「保存」ボタン（Ctrl+S）で保存

### 2.3 権限の設定
初回実行時に以下の権限が要求されます：
- スプレッドシートの読み書き
- メール送信
- トリガーの作成・管理

「許可を確認」をクリックして権限を付与してください。

## 🚀 ステップ3: 初期設定の実行

### 3.1 設定シートテンプレートの作成
1. Apps Scriptエディタで関数ドロップダウンから `createSettingsTemplate` を選択
2. 「実行」ボタンをクリック
3. スプレッドシートの `設定` シートにテンプレートが作成されます

### 3.2 ログシートの作成
1. 関数ドロップダウンから `createLogSheet` を選択
2. 「実行」ボタンをクリック
3. `ログ` シートにヘッダーが作成されます

### 3.3 設定値の入力
`設定` シートで以下の設定を必要に応じて変更：

**必須設定:**
```
送信先: your-email@example.com
```

**推奨設定:**
```
送信時刻(24h): 09:10
タイムゾーン: Asia/Tokyo
エラー通知先: admin@example.com
```

## 🚀 ステップ4: テスト実行

### 4.1 前日データの準備
1. `前日` シートに以下のような前日データを手動で入力（テスト用）：

```
| ID   | 名称   | 値    |
|------|--------|-------|
| P001 | 商品A  | 10000 |
| P002 | 商品B  | 8000  |
| P003 | 商品C  | 15000 |
```

### 4.2 テスト実行
1. Apps Scriptエディタで `testRun` 関数を選択
2. 「実行」ボタンをクリック
3. 実行ログを確認
4. 設定した送信先にメールが届くことを確認

### 4.3 結果の確認
- **メール**: HTMLレポートが正しく表示されているか
- **ログシート**: 実行結果が記録されているか
- **前日シート**: 今日のデータで更新されているか

## 🚀 ステップ5: 定時実行の設定

### 5.1 トリガーのインストール
1. Apps Scriptエディタで `installTrigger` 関数を選択
2. 「実行」ボタンをクリック
3. 設定された時刻に毎日実行されるトリガーが作成されます

### 5.2 トリガーの確認
1. Apps Scriptエディタの左サイドバーで「トリガー」をクリック
2. `runDailyReport` 関数のトリガーが表示されることを確認

## 🔧 ステップ6: 運用開始

### 6.1 日次のデータ更新
1. 毎日、`今日` シートに最新データを更新
2. 設定された時刻に自動でレポートが送信されます

### 6.2 監視項目
- **ログシートの確認**: 毎日の実行結果を確認
- **エラーメール**: 失敗時にはエラー通知メールが送信されます

## 🎯 よくある初期設定エラーと対処法

### エラー1: 「シートが見つかりません」
**原因**: シート名が正しくない
**対処**: 設定シートの `シート_今日`, `シート_前日` の値を確認

### エラー2: 「IDカラムが見つかりません」
**原因**: データシートに `ID` 列がない
**対処**: `今日` シートのA列に `ID` ヘッダーを追加

### エラー3: 「送信先が設定されていません」
**原因**: 設定シートに送信先が未入力
**対処**: 設定シートの `送信先` に有効なメールアドレスを入力

### エラー4: 権限エラー
**原因**: 必要な権限が付与されていない
**対処**: Apps Scriptで権限確認を再実行

## 💡 高度な設定

### 複数指標の比較
```
差分判定対象列: 売上,利益,個数
```
と設定すると、複数の列を同時に比較できます。

### CSV添付の有効化
```
CSV添付: true
```
と設定すると、差分データをCSVファイルとして添付します。

### 差分0時の送信抑止
```
差分0でも送信: false
```
と設定すると、変化がない場合はメールを送信しません。

## 📞 サポート

設定に困った場合は、以下の情報を準備してお問い合わせください：
- エラーメッセージ（Apps Scriptの実行ログ）
- 設定シートのスクリーンショット
- データシートのヘッダー行

---

このガイドに従って設定すれば、業績データの前日比較レポートが自動で送信されるようになります。🎉
